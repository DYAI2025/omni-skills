# LeanDeep Marker Annotator â€“ Chrome Extension

## Was ist das?

Diese Chrome-Extension visualisiert Marker-Annotationen (ATO/SEM/CLU/MEMA) auf Webseiten.  
Sie kommuniziert mit dem FastAPI-Server (Port 8642) und highlightet Textpassagen mit farbcodierten Overlays.

## Features

- **Vier Marker-Level**: ATO (Violett), SEM (Blau), CLU (Orange), MEMA (Rot)
- **Overlapping-Spans**: Mehrere Marker auf demselben Text â†’ Streifenmuster
- **Dark-Mode**: Automatisch (via `prefers-color-scheme`) oder manuell (Light/Dark-Button)
- **In-Page-Panel**: SIT-Slider (0.0â€“1.0), Theme-Buttons, Enable/Disable
- **AA-konform**: WCAG 2.1 Level AA Kontrast-Ratios

## Installation

### 1. Server starten

Stelle sicher, dass der FastAPI-Server lÃ¤uft:

```bash
cd skill-anotation/scripts/python
python server.py
```

ÃœberprÃ¼fe: http://127.0.0.1:8642/health

### 2. Extension installieren

1. Chrome Ã¶ffnen â†’ `chrome://extensions`
2. **Developer mode** aktivieren (Toggle oben rechts)
3. **Load unpacked** klicken
4. Verzeichnis `skill-anotation/chrome-extension/` auswÃ¤hlen

Die Extension ist nun aktiv.

## Verwendung

### Annotation aktivieren

1. Beliebige Webseite Ã¶ffnen (z.B. Wikipedia-Artikel)
2. Rechts oben sollte das Panel "ğŸ¯ Marker Annotator" erscheinen
3. **SIT-Slider** anpassen (0.0 = niedrig, 1.0 = hoch)
4. **Enable Annotation** klicken

â†’ Die Seite wird zum Server geschickt, Marker erkannt, Highlights angewendet.

### Theme wechseln

Im Panel drei Buttons:
- **Auto**: Folgt OS-Theme (`prefers-color-scheme`)
- **â˜€ï¸ Light**: Erzwingt helles Design
- **ğŸŒ™ Dark**: Erzwingt dunkles Design

Wahl wird in `localStorage` gespeichert.

### Annotation deaktivieren

**Disable Annotation** klicken â†’ Alle Highlights verschwinden.

## Troubleshooting

### "Keine Annotationen erhalten"

- Server lÃ¤uft nicht â†’ `python server.py` starten
- CORS-Fehler â†’ Server-CORS-Policy prÃ¼fen (sollte `allow_origins=["*"]` sein)
- Port blockiert â†’ `lsof -i :8642` checken

### "Panel erscheint nicht"

- Extension installiert? â†’ `chrome://extensions` prÃ¼fen
- Console-Fehler? â†’ F12 â†’ Console â†’ nach Fehlern suchen
- Content-Script geladen? â†’ F12 â†’ Sources â†’ content.js sollte sichtbar sein

### "Farben falsch / zu hell / zu dunkel"

- CSS-Variablen prÃ¼fen: F12 â†’ Elements â†’ `:root` â†’ Computed Styles
- Dark-Mode aktiv? â†’ Console: `isDarkMode()` ausfÃ¼hren
- Manuelles Theme gesetzt? â†’ `localStorage.getItem("ld-theme")` prÃ¼fen

### "Ãœberlappende Marker zeigen keine Streifen"

- Mehrere Marker auf derselben Position? â†’ Server-Response checken
- `segmentize()` funktioniert? â†’ Console: `console.log(segments)`
- Gradient korrekt? â†’ Inspect Element â†’ `background` Style

## Entwicklung

### Ã„nderungen testen

1. Code in `content.js` oder `styles.css` bearbeiten
2. Chrome â†’ `chrome://extensions` â†’ **Reload** (Icon neben der Extension)
3. Webseite neu laden (F5)

### Debugging

**Console-Log aktivieren**:
```javascript
console.log("Current SIT:", currentSIT);
console.log("Dark Mode:", isDarkMode());
console.log("Annotations:", annotations);
```

**Network-Tab**:
- F12 â†’ Network â†’ `annotate` Request checken
- Request Payload: `{texts: [...], sit: 0.5}`
- Response: `{annotations: [...], clusters: [...], ...}`

## Datenschutz

- **Keine Daten werden extern gesendet** (nur zu `127.0.0.1:8642`)
- `localStorage` speichert nur Theme-PrÃ¤ferenz
- Keine Tracking / Telemetrie
- Alle Daten bleiben lokal

## Deinstallation

1. Chrome â†’ `chrome://extensions`
2. Extension finden â†’ **Remove**
3. Optional: Server stoppen (Ctrl+C)

## Support

Bei Problemen:
1. Console-Log checken (F12 â†’ Console)
2. Server-Log checken (`python server.py` Terminal)
3. `quick_validate.py` ausfÃ¼hren â†’ Struktur prÃ¼fen
